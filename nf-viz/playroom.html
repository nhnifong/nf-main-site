<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="%VITE_ASSET_BUCKET_URL%/assets/favicon.png" />
    <title>nf-viz</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      /* The UI Layer sits on top of the Three.js canvas. */
      #ui-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 10;
        padding: 20px;
        box-sizing: border-box;
        pointer-events: none; 

        display: grid;
        grid-template-columns: 312px 1fr 520px; 
        grid-template-rows: auto minmax(0, 1fr) auto; /* Added auto row for header */
        grid-template-areas: 
          "header header header"
          "left center right"
          "footer footer footer";
        gap: 20px;
      }

      /* Landing Layer (Login / LAN selection) */
      #landing-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 20; /* Above UI layer */
        background: rgba(40, 40, 40, 0.95);
        backdrop-filter: blur(15px);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
      }

      .landing-panel {
        position: relative; /* Context for absolute children like back button */
        background: #333;
        padding: 40px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        border: 1px solid #555;
        text-align: center;
        max-width: 500px;
        width: 100%;
      }

      .landing-title {
        font-size: 1.8rem;
        margin-bottom: 30px;
        color: #eee;
      }

      .landing-btn {
        display: block;
        width: 100%;
        padding: 16px;
        margin-bottom: 16px;
        border: none;
        border-radius: 8px;
        font-size: 1.1rem;
        cursor: pointer;
        font-weight: bold;
        transition: transform 0.1s, box-shadow 0.2s;
      }

      .btn-lan {
        background-color: #555;
        color: #eee;
        border: 1px solid #777;
      }
      .btn-lan:hover { background-color: #666; }

      .btn-cloud {
        background-color: #4CAF50;
        color: white;
      }
      .btn-cloud:hover { background-color: #43a047; }

      .btn-sim {
        background-color: #2196F3;
        color: white;
      }
      .btn-sim:hover { background-color: #1976D2; }

      .landing-hint {
        font-size: 0.85rem;
        color: #aaa;
        margin-top: 10px;
      }

      .robot-list {
        margin-top: 20px;
        text-align: left;
        max-height: 300px;
        overflow-y: auto;
      }

      .robot-list-item {
        background: #444;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid transparent;
      }

      .robot-list-item:hover {
        background: #505050;
        border-color: #666;
      }

      .robot-name { font-weight: bold; font-size: 1.1em; }
      .robot-id { font-size: 0.8em; color: #888; font-family: monospace; }
      
      .status-badge {
        font-size: 0.8em;
        padding: 4px 8px;
        border-radius: 4px;
        background: #666;
        color: #ccc;
      }
      .status-online { background: #1b5e20; color: #a5d6a7; }

      .btn-unbind {
        background: transparent;
        border: none;
        color: #888;
        cursor: pointer;
        padding: 8px;
        margin-left: 10px;
        font-size: 1.2em;
        transition: color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .btn-unbind:hover {
        color: #f44336; /* Red on hover */
      }

      /* Panel Back Arrow */
      .panel-back-btn {
        position: absolute;
        top: 20px;
        left: 20px;
        background: transparent;
        border: none;
        color: #888;
        font-size: 2.5rem;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        transition: color 0.2s;
      }
      .panel-back-btn:hover {
        color: white;
      }

      /* Input styles for bind panel */
      .input-text {
        width: 100%;
        padding: 12px;
        margin: 15px 0;
        background: #222;
        border: 1px solid #555;
        color: white;
        border-radius: 6px;
        font-size: 1rem;
        box-sizing: border-box;
      }
      .input-text:focus {
        border-color: #4CAF50;
        outline: none;
      }

      /* Common styles for all panels */
      .panel {
        background: rgba(155, 155, 145, 0.85);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.5);
        pointer-events: auto; 
        display: flex;
        flex-direction: column;
      
        /* left and right panels can scroll if needed */
        overflow-y: auto; 
        max-height: 100%;
      }

      /* Hide scrollbar for Chrome/Safari/Opera */
      .panel::-webkit-scrollbar {
        display: none;
      }
      /* Hide scrollbar for IE, Edge and Firefox */
      .panel {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
      }

      /* Header Panel */
      #panel-header {
        grid-area: header;
        height: auto;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 8px 20px;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .header-title {
        margin: 0;
        padding: 0;
        border: none;
        font-size: 1.1rem;
        color: #000;
        font-weight: 700;
      }

      .header-link {
        color: #000;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.9rem;
        margin-left: 20px;
        transition: color 0.2s;
      }
      .header-link:hover { color: white; }

      .header-back-btn {
        background: rgba(0,0,0,0.2);
        border: 1px solid rgba(255,255,255,0.2);
        color: #eee;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.2s;
      }
      .header-back-btn:hover {
        background: rgba(255,255,255,0.1);
        border-color: rgba(255,255,255,0.5);
      }

      /* Progress Bar in Header */
      #op-progress-container {
        flex-grow: 1;
        max-width: 900px;
        margin: 0 40px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 4px;
      }
      
      .op-info {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
        color: #ddd;
        line-height: 1.2;
      }
      
      #op-name {
        font-weight: bold;
        color: black;
      }
      
      #op-action {
        font-family: monospace;
        color: black;
      }

      .op-bar-bg {
        height: 8px;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 4px;
        overflow: hidden;
      }

      #op-bar-fill {
        height: 100%;
        background-color: #007fff; /* Matches theme blue */
        width: 0%;
        transition: width 0.2s ease-out;
        box-shadow: 0 0 10px rgba(0, 127, 255, 0.5);
      }

      /* Left Panel: Tasks */
      #panel-left {
        grid-area: left;
      }

      h2 {
        margin-top: 0;
        font-size: 1.2rem;
        color: #444;
        border-bottom: 2px solid #ddd;
        padding-bottom: 8px;
        margin-bottom: 12px;
      }

      .task-item {
        background: rgba(255, 255, 255, 0.6);
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 8px;
        font-size: 0.9rem;

        display: flex;
        justifyContent: space-between;
        alignItems: center;
      }

      .task-item.active {
        border-left: 4px solid #4CAF50;
        background: rgba(255, 255, 255, 0.9);
        font-weight: bold;
      }

      .task-item {
        /* Layout */
        display: flex;
        justify-content: space-between;
        align-items: center;

        /* Visuals */
        background: rgba(255, 255, 255, 0.3);
        padding: 0;
        margin-bottom: 4px;
        border-radius: 8px;
        border-left: 4px solid transparent; /* space for status color */
        border-left-color: #ffffff; /* Default White */
        
        /* Text */
        font-family: 'Space Mono', monospace;
        font-size: 0.8rem;
        color: #000000;
        
        /* Interaction */
        cursor: pointer;
      }

      .task-item:hover:not(.target-mouse-selected), .target-mouse-hovered:not(.target-mouse-selected) {
          background: rgba(0, 255, 255, 0.3);
      }

      .task-delete {
        cursor: pointer;
        padding: 6px 6px;
        border-radius: 4px;
        margin: 2px;
        font-weight: bold;
        font-size: 1em;
        color: #555;
        border: none;
        background: transparent;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        transition: background-color 0.2s, color 0.2s;
        display: none; /* initially hidden */
      }

      .task-delete:hover {
        background-color: rgba(200, 50, 50, 0.15);
        color: #d00;
      }

      .task-text-span {
        margin: 8px 10px;
      }

      /* Status Colors. Text color always black. target status affects the border, mouse hover status affects the background*/
      .status-seen {
          border-left-color: #ffffff; /* White */
      }

      .status-selected {
          border-left-color: #007fff; /* Blue */
      }

      .status-picked-up {
          border-left-color: #ffd700; /* Gold */
      }

      /* appearance of a target that was selected by the mouse */
      .target-mouse-selected {
          background: rgba(255, 165, 0, 0.8); /* orange */
      }

      /* Right Panel: Video Feeds */
      #panel-right {
        grid-area: right;
        gap: 15px;
        background: transparent; 
        box-shadow: none;
        border: none;
        backdrop-filter: none;
        padding: 0;
        /* Re-enable overflow for the container of feeds */
        overflow-y: auto; 
      }

      .video-feed {
        background: #000;
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        border: 2px solid #333;
        flex-shrink: 0; /* Prevent videos from squishing */
      }

      .video-feed video, .video-feed img.mjpeg-feed {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .video-feed canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2; /* Canvas above video */
        pointer-events: auto;
        cursor: crosshair;
      }

      .feed-16-9 {
        width: 100%;
        aspect-ratio: 16 / 9;
      }
      
      .feed-1-1 {
        width: 66%;
        aspect-ratio: 1 / 1;
        align-self: flex-end;
      }

      .feed-label {
        position: absolute;
        bottom: 8px;
        left: 8px;
        background: rgba(0, 0, 0, 0.6);
        color: white;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.75rem;
        z-index: 3;
        pointer-events: none;
      }

      /* Footer */
      #panel-footer {
        grid-area: footer;
        height: auto;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: flex-start; /* Start from left, we'll use auto-margins if needed */
        gap: 0; /* Gap handled by sections */
        
        /* Footer shouldn't scroll */
        overflow: visible; /* popup menu from run button must be visible even if outside of footer */ 
        padding: 10px 20px;
      }

      /* --- RUN MENU STYLES --- */
      .run-menu-container {
        position: relative;
        display: inline-block;
      }

      .run-button {
        background-color: #4CAF50;
        color: white;
        padding: 12px 28px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        font-size: 1rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .run-button.disabled {
        color: #aaa;
        background-color: #222;
        cursor: default;
      }

      .run-button:hover:not(.disabled) {
        background-color: #43a047;
      }

      /* Drop-up Content */
      .run-menu-content {
        display: none;
        position: absolute;
        bottom: 120%; /* Position above the button */
        left: 0;
        background-color: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        min-width: 240px;
        box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
        z-index: 100;
        border-radius: 12px;
        padding: 8px 0;
        border: 1px solid rgba(0,0,0,0.1);
        
        /* Animation */
        transform-origin: bottom left;
        animation: popUp 0.1s ease-out;
      }

      @keyframes popUp {
        from { opacity: 0; transform: scale(0.95) translateY(10px); }
        to { opacity: 1; transform: scale(1) translateY(0); }
      }

      .run-menu-content.show {
        display: block;
      }

      .menu-item {
        color: #333;
        padding: 12px 20px;
        text-decoration: none;
        display: block;
        cursor: pointer;
        font-size: 0.95rem;
        transition: background-color 0.1s;
        border-bottom: 1px solid rgba(0,0,0,0.05);
      }
      
      .menu-item:last-child {
        border-bottom: none;
      }

      .menu-item:hover:not(.disabled) {
        background-color: #e8f5e9; /* Light green tint */
        color: #2e7d32;
      }

      /* Disabled state */
      .menu-item.disabled {
        color: #aaa;
        background-color: transparent;
      }

      /* --- END RUN MENU --- */

      .footer-section {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.9rem;
        color: #333;
      }
      
      /* Vertical stacking for diagnostics */
      .footer-stats-group {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
        gap: 4px;
        font-size: 0.85rem;
      }

      .stat-line {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .footer-divider {
        width: 1px;
        height: 40px;
        background-color: rgba(0,0,0,0.15);
        margin: 0 20px;
      }

      /* Push the last section (Telemetry) to the far right */
      .footer-spacer {
        flex-grow: 1;
      }

      .status-dot {
        height: 10px;
        width: 10px;
        background-color: #4CAF50; /* Green */
        border-radius: 50%;
        display: inline-block;
        box-shadow: 0 0 5px #4CAF50;
      }
      
      .status-offline {
        background-color: #f44336;
        box-shadow: 0 0 5px #f44336;
      }

      .label-muted {
        color: #444;
        margin-right: 4px;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* --- COMPONENT STATUS MENU STYLES --- */
      .component-menu-container {
        position: relative;
      }

      .component-status-btn {
        background: transparent;
        border: 1px solid transparent;
        border-radius: 6px;
        cursor: pointer;
        text-align: left;
        padding: 4px 6px;
        margin: -4px -6px; /* offset padding to maintain alignment */
        transition: background 0.2s, border-color 0.2s;
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
      }

      .component-status-btn:hover {
        background: rgba(255, 255, 255, 0.4);
        border-color: rgba(0, 0, 0, 0.1);
      }

      /* Re-using .run-menu-content for the pop-up shape, adding overrides */
      .component-list-popup {
        min-width: 320px;
        padding: 0;
        overflow: hidden;
      }

      .comp-row {
        padding: 10px 16px;
        border-bottom: 1px solid rgba(0,0,0,0.05);
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .comp-row:last-child {
        border-bottom: none;
      }

      .comp-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: bold;
        font-size: 0.95rem;
        color: #333;
      }

      .comp-details {
        font-family: 'Space Mono', monospace;
        font-size: 0.8rem;
        color: #666;
        display: flex;
        justify-content: space-between;
      }

      .comp-status-good {
        color: #2e7d32;
        font-weight: bold;
      }
      
      .comp-status-bad {
        color: #d32f2f;
        font-weight: bold;
      }
      /* --- END COMPONENT STATUS MENU --- */


      /* --- Perspective Buttons Styling --- */
      .perspective-container {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 12px;
        margin-left: 15px;
      }

      .perspective-label {
        font-weight: bold;
        font-size: 0.85rem;
        color: #333;
        text-align: right;
        line-height: 1.1;
        max-width: 90px;
      }

      .perspective-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 6px;
      }

      .perspective-button {
        background-color: #555;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 6px 12px;
        font-weight: bold;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition: background-color 0.2s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        
        display: flex;
        align-items: center;
        justify-content: center;
        white-space: nowrap;
        min-width: 100px;
      }

      .perspective-button:hover:not(.perspective-button-selected) {
        background-color: #333;
      }

      .perspective-button:active {
        transform: translateY(1px);
        box-shadow: 0 1px 2px rgba(0,0,0,0.2);
      }

      .perspective-button-selected {
        background-color: #005;
      }


      .stop-button {
        background-color: #d32f2f;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 8px 24px;
        font-weight: bold;
        font-size: 0.9rem;
        letter-spacing: 1px;
        cursor: pointer;
        transition: background-color 0.2s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        margin-left: 20px;
      }

      .stop-button:hover {
        background-color: #b71c1c;
      }

      .stop-button:active {
        transform: translateY(1px);
        box-shadow: 1px 2px rgba(0,0,0,0.2);
      }

      .hidden {
          display: none !important;
      }

      #popup-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.7); /* Dimmed background */
          z-index: 9999; /* On top of everything */
          display: flex;
          justify-content: center;
          align-items: center;
      }

      #confirm-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.7);
          z-index: 9999;
          display: flex;
          justify-content: center;
          align-items: center;
      }

      .popup-box {
          background: #2a2a2a;
          border: 1px solid #444;
          padding: 20px 30px;
          border-radius: 8px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
          text-align: center;
          min-width: 300px;
      }

      #popup-message, #confirm-message {
          color: #fff;
          font-size: 1.1em;
          margin-bottom: 20px;
          white-space: pre-wrap; /* Preserve line breaks */
      }

      #popup-ok {
          background: #007fff;
          color: white;
          border: none;
          padding: 8px 24px;
          border-radius: 4px;
          cursor: pointer;
          font-size: 1em;
          transition: background 0.2s;
      }

      #popup-ok:hover {
          background: #0066cc;
      }

      .orbit-image {
        display: inline-block; /* Treats it like a text character */
        height: 1em;
        width: auto;
        padding-right: 10px;
        vertical-align: middle;/* Aligns it vertically with text */
        background-size: contain; /* Scales image to fit within its box */
        background-repeat: no-repeat;
        background-position: center;
        max-width: 100%;
        line-height: 1;
      }

    </style>
  </head>
  <body>
    <!-- The 3D Canvas will be appended here by main.ts (z-index auto/0) -->

    <!-- Landing Layer (Login / LAN selection) -->
    <div id="landing-layer" class="hidden">
      <div class="landing-panel" id="landing-options">
        <div class="landing-title">Select Connection Mode</div>
        
        <button id="btn-lan-mode" class="landing-btn btn-lan">
          LAN only mode
          <div class="landing-hint">Connect to robot controller on localhost</div>
        </button>

        <button id="btn-sim-mode" class="landing-btn btn-sim">
          Explore simulated robot
          <div class="landing-hint">Interact with a virtual Stringman (pilot version)</div>
        </button>

        <button id="btn-cloud-mode" class="landing-btn btn-cloud">
          Log in
          <div class="landing-hint">Manage your cloud-connected robots</div>
        </button>
        
        <div class="landing-hint">
          <a href="/docs/lan_only_guide/" style="color:#aaa">Learn more about Stringman data privacy</a>
        </div>
      </div>

      <div class="landing-panel hidden" id="robot-list-panel">
        <button id="btn-robot-list-back" class="panel-back-btn" title="Back">‹</button>
        <div class="landing-title">Select a Robot</div>
        <div id="robot-list-container" class="robot-list">
          <!-- Robot items will be injected here -->
          <div style="color: #888; padding: 20px;">Loading robots...</div>
        </div>
      </div>

      <div class="landing-panel hidden" id="bind-robot-panel">
        <div class="landing-title">Bind Robot</div>
        
        <p style="color: #ccc; margin-bottom: 20px;">
          Give this robot a nickname to identify it in your cloud dashboard. (e.g. "bedroom")
        </p>

        <input type="text" id="bind-nickname" class="input-text" placeholder="e.g. Living Room Bot" value="Stringman">

        <button id="btn-confirm-bind" class="landing-btn btn-cloud">
          Bind to my account
          <div class="landing-hint">This robot will become accessible in cloud mode.</div>
        </button>

        <button id="btn-cancel-bind" class="landing-btn btn-lan">
          Cancel
        </button>
      </div>
    </div>

    <!-- UI Overlay Layer (z-index 10) -->
    <div id="ui-layer">

      <!-- HEADER -->
      <header id="panel-header" class="panel">
        <div class="header-left">
          <h2 class="header-title">Stringman Control Panel</h2>
          <button id="btn-header-back" class="header-back-btn">Change Robot</button>
        </div>
        <div id="op-progress-container" class="hidden">
          <div class="op-info">
            <span id="op-name">Operation</span>
            <span id="op-action">Initializing...</span>
          </div>
          <div class="op-bar-bg">
            <div id="op-bar-fill"></div>
          </div>
        </div>
        <div class="header-right">
          <a href="/" class="header-link">HOME</a>
          <a href="/docs/usage_guide/" class="header-link">GUIDE</a>
        </div>
      </header>
      
      <!-- Left Panel: Task & Targets -->
      <aside id="panel-left" class="panel">
        <h2>Targets</h2>
        <div id="target-list">
          <div class="task-item status-selected">
            <span class="task-text-span">Moving to (-0.5, 0.2)</span>
            <button class="task-delete">✗</button>
          </div>
          <div class="task-item status-picked-up">
            <span class="task-text-span">Moving to (-0.5, 0.2)</span>
            <button class="task-delete">✗</button>
          </div>
          <div class="task-item status-seen">
            <span class="task-text-span">Moving to (-0.5, 0.2)</span>
            <button class="task-delete">✗</button>
          </div>
        </div>
      </aside>

      <!-- Right Panel: Video Feeds -->
      <aside id="panel-right" class="panel">
        <div class="video-feed feed-16-9" id="firstOverhead">
          <video class="feed-video" autoplay muted playsinline poster="%VITE_ASSET_BUCKET_URL%/assets/waiting_for_video.png" onended="this.load()"></video>
          <img src="" class="mjpeg-feed hidden" /><!-- Tag used for LAN mjpeg stream -->
          <canvas class="feed-canvas"></canvas>
          <div class="feed-label">ANCHOR 01</div>
        </div>
        <div class="video-feed feed-16-9" id="secondOverhead">
          <video class="feed-video" autoplay muted playsinline poster="%VITE_ASSET_BUCKET_URL%/assets/waiting_for_video.png" onended="this.load()"></video>
          <img src="" class="mjpeg-feed hidden" />
          <canvas class="feed-canvas"></canvas>
          <div class="feed-label">ANCHOR 02</div>
        </div>
        <div class="video-feed feed-1-1" id="gripper">
          <video class="feed-video" autoplay muted playsinline poster="%VITE_ASSET_BUCKET_URL%/assets/waiting_for_video_square.png" onended="this.load()"></video>
          <img src="" class="mjpeg-feed hidden" />
          <canvas class="feed-canvas"></canvas>
          <div class="feed-label">GRIPPER</div>
        </div>
      </aside>

      <!-- Footer Panel -->
      <footer id="panel-footer" class="panel">

        <!-- Run Menu -->
        <div class="run-menu-container">
          <button id="run-btn" class="run-button disabled">
            <span>RUN</span>
            <span style="font-size: 0.8em">▲</span>
          </button>
          <div id="run-menu" class="run-menu-content">
            <!-- Menu Items hooked up in main.ts -->
            <div id="action-pick-drop" class="menu-item">Pick and drop targets</div>
            <div id="action-tension" class="menu-item">Tension all lines (D-up)</div>
            <div id="action-half-cal" class="menu-item">Quick Calibration (D-left)</div>
            <div id="action-record-park" class="menu-item">Set Parking Location</div>
            <div id="action-park" class="menu-item">Park</div>
            <div id="action-unpark" class="menu-item">UnPark</div>
            <div id="action-grasp" class="menu-item">Auto Grasp Here (D-right)</div>
            <div id="action-maintenance" class="menu-item" style="border-top: 1px solid #ccc; font-weight: bold;">Calibration and Maintenance</div>
            <div id="action-bind" class="menu-item hidden" style="border-top: 1px solid #ccc; color: #007fff; font-weight: bold;">Bind to account</div>
          </div>

          <!-- Maintenance Sub-Menu -->
          <div id="maintenance-menu" class="run-menu-content">
            <div id="action-maint-back" class="menu-item" style="font-weight:bold; color:#555;">&larr; Back</div>
            <div style="border-bottom:1px solid #ddd; margin-bottom:5px;"></div>
            
            <div id="action-full-cal" class="menu-item">Full Calibration</div>
            <div id="action-dataset" class="menu-item">Add targets to dataset</div>
            <div id="action-collect-images" class="menu-item">Collect Gripper Images</div>
            <div id="action-update-firmware" class="menu-item">Update Firmware on Components</div>
            
            <div class="menu-item" style="cursor: default; padding: 8px 20px;">
                <div style="font-size:0.8em; margin-bottom:4px;">Debug Command</div>
                <div style="display:flex; gap:8px;">
                    <input type="text" id="debug-input" class="input-text" style="padding:4px; margin:0; font-size:0.9rem;" placeholder="cmd">
                    <button id="action-debug-send" class="run-button" style="padding:4px 10px; font-size:0.8rem;">Send</button>
                </div>
            </div>
          </div>
        </div>

        <div class="footer-divider"></div>

        <!-- System Status -->
        <div class="footer-stats-group">
           <div class="stat-line">
            <span id="status-dot-el" class="status-dot status-offline"></span> 
            <strong id="status-text">Offline</strong>
           </div>
           <div class="stat-line">
             <span class="label-muted">Robot ID</span>
             <strong id="ui-robot-id">Unknown</strong>
           </div>
           <!-- Component Status -->
           <div class="component-menu-container">
               <button id="component-status-btn" class="component-status-btn">
                 <!-- <span class="label-muted">Status</span> -->
                 <strong id="component-status-text">Anchors (0/0)</strong>
               </button>
               <div id="component-menu" class="run-menu-content component-list-popup">
                 <!-- Populated by JS -->
                 <div class="menu-item disabled">Waiting for telemetry...</div>
               </div>
           </div>
        </div>

        <div class="footer-divider"></div>

        <!-- Perspective Grid -->
        <div class="perspective-container">
           <div class="perspective-label">Motion<br>Perspective</div>
           <div class="perspective-grid">
              <button id="btn-viewport" class="perspective-button"><img src="%VITE_ASSET_BUCKET_URL%/assets/orbit_icon.png" class="orbit-image"/>Viewport</button>
              <button id="btn-top" class="perspective-button"><img src="%VITE_ASSET_BUCKET_URL%/assets/orbit_icon.png" class="orbit-image"/>Anchor 1</button>
              <button id="btn-person" class="perspective-button perspective-button-selected"><img src="%VITE_ASSET_BUCKET_URL%/assets/orbit_icon.png" class="orbit-image"/>Seat Tag</button>
              <button id="btn-bottom" class="perspective-button"><img src="%VITE_ASSET_BUCKET_URL%/assets/orbit_icon.png" class="orbit-image"/>Anchor 2</button>
              <button id="btn-gripper" class="perspective-button"><img src="%VITE_ASSET_BUCKET_URL%/assets/orbit_icon.png" class="orbit-image"/>Gripper</button>
           </div>
        </div>

        <!-- Spacer pushes next items to the right -->
        <div class="footer-spacer"></div>

        <!-- how-to messages -->
        <div class="footer-stats-group">
           <div class="stat-line">
            <strong id="how-to"></strong>
           </div>
        </div>

        <!-- Spacer pushes next items to the right -->
        <div class="footer-spacer"></div>

        <!-- Diagnostics -->
        <div class="footer-stats-group">
           <div class="stat-line">
             <span class="label-muted">Detections/sec</span>
             <span id='detectionRate'>101.2</span>
           </div>
           <div class="videoLatency">
             <span class="label-muted">Video latency</span>
             <span id="videoLatency">0.22 s</span>
           </div>
           <div class="avgFramerate">
             <span class="label-muted">Avg framerate</span>
             <span id="videoFramerate">29.2 fps</span>
           </div>
        </div>

        <div class="footer-divider"></div>

        <button id="stop-btn" class="stop-button">STOP</button>
      </footer>

    </div>

    </div>

    <div id="popup-overlay" class="hidden">
      <div class="popup-box">
        <p id="popup-message">Default Message</p>
        <button id="popup-ok">OK</button>
      </div>
    </div>

    <!-- Confirmation Overlay -->
    <div id="confirm-overlay" class="hidden">
      <div class="popup-box">
        <p id="confirm-message">Are you sure?</p>
        <div style="display:flex; justify-content:center; gap:10px;">
          <button id="confirm-yes" class="run-button">Yes</button>
          <button id="confirm-no" class="run-button" style="background:#555">No</button>
        </div>
      </div>
    </div>

    <!-- Main Logic -->
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>